---
import path from 'node:path';
import type { HTMLAttributes } from 'astro/types';
import { imageSize } from 'image-size';
import { Env } from '@/constants/env';
import { dirName } from '@/helper/node/path';
export type Props = HTMLAttributes<'svg'> & {
  hash: string;
};
const { hash, ...restProps } = Astro.props;
const target = import.meta.env.PROD
  ? path
      .resolve(dirName, '../../')
      .replace(
        `dist${import.meta.env.BASE_URL.replace(/\/$/, '')}`,
        `src/assets/svg-sprite/${hash}.svg`,
      )
  : path.resolve(dirName, `../../assets/svg-sprite/${hash}.svg`);

const { width, height } = imageSize(target);
const attr = {
  viewBox: `0 0 ${width} ${height}`,
  ...restProps,
};
---

<svg role="img" {...attr}>
  <use
    xlink:href={`${import.meta.env.BASE_URL}${Env.assets.sprite.outDir}/${
      Env.assets.sprite.outName
    }.svg#${hash}`}></use>
</svg>
